version: '3'

services:

  hivemq:
    image: "hivemq/hivemq4"
    container_name: mqttbroker
    environment:
      - HIVEMQ_ALLOW_ALL_CLIENTS=true
    ports:
      - "1883:1883"

  joynr-gcd-db:
    image: "joynr-gcd-db"
    container_name: "joynr-gcd-db"
    environment:
      - POSTGRES_USER=statelessasync
      - POSTGRES_PASSWORD=statelessasync
      - POSTGRES_DB=statelessasync

  joynr-gcd:
    image: "joynr-gcd-db:latest"
    container_name: joynr-gcd
    depends_on:
      - "hivemq"
      - "joynr-gcd-db"
    environment:
      - joynr_messaging_mqtt_brokeruris=tcp://mqttbroker:1883
      - joynr_gcd_db_host=joynr-gcd-db
      - joynr_gcd_gbid=joynrdefaultgbid
      - joynr_gcd_valid_gbids=joynrdefaultgbid
      - joynr_messaging_gbids=joynrdefaultgbid

  carsim:
    image: "stateless-async-car-sim:latest"
    container_name: carsim

  jee-carsim:
    image: "stateless-async-jee-car-sim:latest"
    container_name: jee-carsim

  jee-consumer-1:
    image: "stateless-async-jee-consumer:latest"
    container_name: jee-consumer-1
    ports:
      - "8081:8080"

  jee-consumer-2:
    image: "stateless-async-jee-consumer:latest"
    container_name: jee-consumer-2
    ports:
      - "8082:8080"

  jee-consumer-3:
    image: "stateless-async-jee-consumer:latest"
    container_name: jee-consumer-3
    ports:
      - "8083:8080"

  java-consumer:
    image: "stateless-async-consumer:latest"
    container_name: java-consumer
