# Standalone performance test - Docker

In order to run standalone performance tests, you need to have built or re-build various
Docker
images which are used by the `docker-compose.yml` script contained in this directory.

## Prerequisites software
* Docker version 19.03.6 or later
* docker-compose version 1.17.1 or later

##  Prerequisites images
Joynr has a variety of docker images. The standalone test needs `joynr-complete-with-joynr` image.
Because joynr, its libraries/runtimes along with joynr dependencies are already installed in it.
However, the images `joynr-complete-with-joynr` depends on another image, namely
`joynr-complete-deps`, which depends on other images.

The easiest way to build all necessary images is to run `joynr-docker` script as follows:
`$ JOYNR_HOME/docker/joynr-docker build`
once `joynr-complete-with-joynr` is built, then the standalone test can build its own images.

## Building standalone test images
* Run `./build_all.sh` script to build the necessary images for standalone test which is located in
the current working directory. This will build these images: `joynr-backend-jee-1`,
`joynr-faked-backend-jee-1`, `joynr-pt-jee-app`, `joynr-pt-cpp-app`. You can issue this command
`docker images` to list current build images. Presumably they should be listed.

## Parameters
For CPP service, before running test scenario, please check available parameters listed in
`./joynr-pt-cpp-app/start-me-up.sh` script. Then pass them through `docker-compose.yml` to `cppapp`
service, concretely to the command . Pre-configured parameters are already set.

## Running test scenario
* Run `./run_pt.sh` script to startup docker-compose, This will create a number of instances of
`cppapp` service equal to the number which you pass to the command:
`docker-compose up -d --scale cppapp=NUM` in this script. Container names will be generated by
docker-compose and will have the following pattern `docker_SERVICENAME_NUM`. Example:
`docker_cppapp_1` and so on.
* The script runs forever, unless the user stops it by Ctrl-c.
* Once the script ended, `results` folder will be created in this working directory containing
  statistics collected from each container.
* The `run_pt.sh` script will stop docker-compose and do all clean up after ending running the
  scenario.
